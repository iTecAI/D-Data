# Specification

## Spells
### Targets

- `specific` - Indicates a number of specific targets
  - `count` - (int)/"string" (required) Number of targets, or "any".
- `area` - Indicates that the targets should be within an area
  - `area` - (int)/{dict} (required) Area width/diameter in feet or one of the following dictionaries.
    - If `area_type` == `rectangle`:
      - `length` - (int) (required) Max length
      - `width` - (int) (required) Width
      - `height` - (int) (required) Height
    - If `area_type` == `ring`:
      - `diameter` - (int) (required) Max diameter
      - `thickness` - (int) (required) Ring thickness
      - `height` - (int) (required) Ring height
    - If `area_type` == `cylinder`:
      - `diameter` - (int) (required) Cylinder diameter
      - `height` - (int) (required) Cylinder height
  - `area_type` - "string" (required) `sphere`, `cube`, `line`, `cone`, `square`, `rectangle`, `ring`
- `prerequisites` - Indicates that the spell has prerequisites
  - `prerequisites` - {dict} (required) Prerequisite definitions
    - `{prerequisite name}` - {dict} (required at least 1).
      - `operator` - "string" (required) Comparison operator (`==`,`<=`,`>=`,`<`,`>`,`!=`) to apply to the `value`
      - `value` - (any) (required) Value to check. If [list], checks all.
    - NOTE: Possible values for {prerequisite name}.
      - Any creature attribute path
      - `condition:<any>` - Selects a specific condition
      - `affected:<any>` - Selects a specific spell effect, such as `affected:Black Tentacles`
      - `condition_immune:<any>` - Matches if immune to condition
  - `prerequisites_match` - "string" (required) Either of `all`, `any`. Indicates whether the target must match all or any of the prerequisites.
- `slot_scale` - Indicates that the spell scales with higher slot levels
  - `slot_scale` - [list] (required)
    - Item - {dict} (required at least 1)
      - `path` - "string" (required) Path to value to append the value to.
      - `value` - (any) (required) Value to add.
- `hazard` - Indicates that the spell will not immediately target creatures but will instead act as a hazard.
  - `hazard_triggers` - [list] (required)
    - Item - "string" (required at least 1) Any of `enters`, `exits`, `turn_start`, `turn_end`, `on_cast` (Effects will trigger on casting as well as on hazard triggers)
- `single_option` - Indicates that this option should not be selected along with other targets with the `single_option` flag.
- `hp_selection` - Indicates that the targets are selected via HP (i.e. the sleep spell)
  - `hp_roll` - "roll string" (required) The amount of HP to affect. Treated as a roll string.
  - `hp_sort` - "string" (required) Sorting of creatures to affect based on HP. Can be `ascending` or `descending`.
- `cantrip_scaling` - Indicates that the spell will change as the player levels.
  - `{level number}` - {dict} (required at least 1)
    - `target` - "string" (required) Path inside the effect dict, such that damage:{roll:-} -> `damage.roll`
    - `value` - (any) (required) Value to set the target path item to.
- `allow_repeat` - Indicates that targets can be repeated

### Effects
- `spell_attack` - Indicates a spell attack
- `failure_effect` - Indicates some effect will occur on a miss/successful save
  - `fail` - [list] (required) List of **Effects**.
- `damage` - Indicates that the effect will deal damage on a hit/failed save
  - `damage` - {dict} (required) Can also be [list] of {dicts}
    - `roll` - "roll string" (required) Roll string
    - `type` - "string" (required) Damage type or "heal". Can also have flags, such as `:magical` or `:adamantine`
    - `recurring` - {dict} (optional) Include if damage continues after the first dealing
      - `roll` - "roll string" (required) Roll string
      - `type` - "string" (required) Damage type or "heal". Can also have flags, such as `:magical` or `:adamantine`
      - `rounds` - (int) (required) Number of rounds to recur for
      - `turn` - "string" (required) Whether to damage on the `start` or `end` of the turn
- `save` - Indicates that a save must be made
  - `save` - "string" (required) Save name, such as `strength` or `dexterity`
  - `save_modifier` - "string" (optional) Add a modifier, `advantage`, or `disadvantage` to the saving throw.
- `save_repeat` - Indicates that the save should be repeated each round.
  - `save_repeat` - "string" (required) When the save should occur on the target's turn. Any of `start`, `end`, or `damage` (this may occur outside of the target's turn).
- `cantrip_scaling` - Indicates that the spell will change as the player levels.
  - `{level number}` - {dict} (required at least 1)
    - `target` - "string" (required) Path inside the effect dict, such that damage:{roll:-} -> `damage.roll`
    - `value` - (any) (required) Value to set the target path item to.
- `required` - Indicates that an effect will occur if its prerequisites are met, and will not appear as an optional effect. If only one optional effect is available, it will activate automatically.
- `attribute` - Indicates that the effect will be changing an attribute on the target
  - `attributes` - [list] (required) List of **Attributes**
    - **Attribute** - {dict} (required at least 1)
      - `path` - "string" (required) Path to attribute on target
      - `operation` - "string" (required) Any of `add`, `subtract`, `multiply`, `divide`, `set`
      - `value` - "roll string" (required) Value to use with operator on attribute
- `condition` - Indicates that the effect applies a condition to the target
  - `condition` - "string"/[list] (required) Condition or list of conditions to apply to the target. Duration is assumed to be that of the spell.
  - `condition_apply` - "string" (optional) `any` or `all`, indicates whether all conditions must be applied or not. Only applicable in the case of `condition` being a list.
- `flavor` - Indicates that the effect will output flavor text on a success
  - `flavor` - "string" (required) Flavor text to output/report
- `roll_modifier` - Indicates that the effect will modify the target's rolls on a success
  - `roll_modifier` - {dict} (required)
    - `roll` - "string" (required) Roll string to add to the target's rolls, or "advantage"/"disadvantage".
    - `affected` - [list] (required at least one) List of rolls to affect. May be `attacks`, `saves`, or `checks`. May also be more specific for `saves` and `checks`, such as `checks.stealth` or `saves.intelligence`
    - `source` - "string" (optional) Restricts effect to rolls caused by/targeted at `source`. Current options: `caster`.
    - `end_on_uses` - (int) (optional) Rolls that can be made until the effect ends. Defaults to unlimited if not included.
- `slot_scale` - Indicates that the spell scales with higher slot levels
  - `slot_scale` - [list] (required)
    - Item - {dict} (required at least 1)
      - `path` - "string" (required) Path to value to append the value to.
      - `value` - (any) (required) Value to add.
- `damage_modifier` - Indicates that the damage the target takes will be affected on a success.
  - `damage_modifier` - {dict} (required)
    - `types` - [list] (required) List of damage types to affect.
    - `operation` - "string" (required) `min`, `max`, or a roll string modifier such as `+5` or `*2`.
    - `source` - "string" (optional) Restricts effect to damage caused by `source`. Current options: `caster`.
- `bonus_inflicted_damage` - Indicates that another full damage element will be added to attacks that hit the target.
  - `bonus_inflicted_damage` - {dict} (required)
    - `types` - [list]/"string" (required) List of damage types to affect or "any"
    - `roll` - "roll string" (required) Roll string to add.
    - `damage_type` - "string" (required) Damage type or "heal". Can also have flags, such as `:magical` or `:adamantine`
    - `source` - "string" (optional) Restricts effect to damage caused by `source`. Current options: `caster`.
- `prerequisites` - Indicates that the spell has prerequisites
  - `prerequisites` - {dict} (required) Prerequisite definitions
    - `{prerequisite name}` - {dict} (required at least 1).
      - `operator` - "string" (required) Comparison operator (`==`,`<=`,`>=`,`<`,`>`,`!=`) to apply to the `value`
      - `value` - (any) (required) Value to check. If [list], checks all.
    - NOTE: Possible values for {prerequisite name}.
      - Any creature attribute path
      - `condition:<any>` - Selects a specific condition
      - `affected:<any>` - Selects a specific spell effect, such as `affected:Black Tentacles`
      - `condition_immune:<any>` - Matches if immune to condition
  - `prerequisites_match` - "string" (required) Either of `all`, `any`. Indicates whether the target must match all or any of the prerequisites.
- `single_option` - Indicates that this option should not be selected along with other effects with the `single_option` flag.
- `attack_modifier` - Indicates that the effect modifies the target's attacks.
  - `attack_modifier` - {dict} (required)
    - `type` - "string" (required) Any of `damage`, `advantage`, `disadvantage`.
    - `damage` - {dict} (required if `type` == `damage`)
      - `roll` - "roll string" (required) Damage roll
      - `type` - "string" (required) Damage type or "heal". Can also have flags, such as `:magical` or `:adamantine`
    - `end_on_uses` - (int) (optional) Attacks that can be made until the effect ends. Defaults to unlimited if not included.
- `hit_modifier` - Indicates that attack rolls to hit the target will be modified.
  - `hit_modifier` - "string"/"roll string" (required) `advantage`, `disadvantage`, or a roll string.
  - `hit_modifier_count` - (int) (optional) The number of hits to affect before this segment of the effect ends.

### Formatting Flags
Some string values can contain formatting flags, as listed below.

- Roll Strings
  - `{spellcasting_ability_modifier}` - The caster's spellcasting ability modifier.
  - `{<ability name>_mod}` - The caster's ability modifier for the specified ability.